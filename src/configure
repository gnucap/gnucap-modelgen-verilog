#!/bin/sh

echo -n '# ' > config.log
date >> config.log
echo $0 "$@" >> config.log

#-------------  Stuff added to enable --prefix  --------------
if test "x$1" != "x"; then
    # echo Found input parameter -- $1
    #  Now see if the parameter is --prefix=
    if test "x${1#--prefix=}" != "x$1"; then
        # echo "Found --prefix in input args.  Setting prefix directory."
        prefix=${1#--prefix=}
    else
        # echo "Found unrecognized parameter in input args."
        #  Just use the default prefix dir.
        prefix=/usr/local
    fi
 
else
    # echo "No input parameter found."
    #  Just use the default prefix dir
    prefix=/usr/local
fi

shift

if test "x${1#--srcdir=}" != "x$1"; then
    srcdir=${1#--srcdir=}
    # echo "Found --srcdir in input args.  Setting srcdir $srcdir."
else
    echo need srcdir >&2
    exit 1
fi

top_srcdir=$srcdir/..

pkglibdir='${prefix}/lib/gnucap'
pkglibdir_expanded="${prefix}/lib/gnucap"
sed -e "s#@pkglibdir_expanded@#$pkglibdir_expanded#" \
	       < $srcdir/config.h.in > config.h


cat <<CAT_EOF >makefile
#------------------------------------------------------------------------
# created by $0 do not edit

CXX = g++
TARGET_EXT =

SRCDIR = $srcdir
VPATH = \${SRCDIR}
include \${SRCDIR}/Make1

\$(TARGET): \$(OBJS)
	\$(CXX) \$(MAKE_CXXFLAGS) \$(CXXFLAGS) \$(MAKE_CPPFLAGS) \$(CPPFLAGS) \$(OBJS) -o \$@ \$(TARGET_LIBS) \$(LDFLAGS)

# BUG: rules don't go here
# temporary workaround, see source
%.raw: %.h
	sed -e 's/^/"/' -e 's/\$\$/\\n"/' \$< > \$@
mg_out_root.o: ${EMBED_HEADERS}

include ../Make2
include $top_srcdir/Make3 # use from gnucap?

.DELETE_ON_ERROR:
#------------------------------------------------------------------------

CAT_EOF
